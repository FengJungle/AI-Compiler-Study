![编译器中语法分析器的位置](./Picture/09.%E7%BC%96%E8%AF%91%E5%99%A8%E4%B8%AD%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90%E5%99%A8%E7%9A%84%E4%BD%8D%E7%BD%AE.png)

语法分析器从词法分析器获得一个由词法单元组成的串，并验证这个串可以由源语言的文法生成。我们期望语法分析器能够以易于理解的方式报告语法错误，并且能够从常见的错误中恢复并继续处理程序的其余部分。
# 1. 自顶向下的分析（Top-Down Parsing）
从分析树的顶部（根节点）向底部（叶节点）方向构造分析树，可以看成是从文法开始符号S**推导**出词串w的过程。    
![推导过程示例](./Picture/10.%E6%96%87%E6%B3%95%E5%88%86%E6%9E%90%E7%A4%BA%E4%BE%8B.png)  

- 每一步推导中 ，都需要做两个选择：
    - 替换当前句型中的**哪个非终结符**
    - 用该终结符的**哪个候选式**进行替换
### 最左推导（Left-most Derivation）
- 在最左推导中，总是选择每个句型的最左非终结符进行替换
![最左推导](./Picture/11.%E6%9C%80%E5%B7%A6%E6%8E%A8%E5%AF%BC%E7%A4%BA%E4%BE%8B.png)

从文法的开始符号，通过最左推导的方式得到的句型，称为是最左句型。
### 最右推导（Right-most Derivation）
- 在最右推导中，总是选择每个句型的最右非终结符进行替换
![最右推导](./Picture/12.%E6%9C%80%E5%8F%B3%E6%8E%A8%E5%AF%BC%E7%A4%BA%E4%BE%8B.png)

- 在自底向上的分析中，总是采用最左规约的方式，因此把**最左规约**称为**规范规约**，而最右推导相应地称为**规范推导**。

### 自顶向下的语法分析采用最左推导方式
- 总是选择每个句型的**最左非终结符**进行替换
- 根据输入流中的**下一个终结符**，选择最左非终结符的一个候选式
![](./Picture/13.%E6%9C%80%E5%B7%A6%E6%8E%A8%E5%AF%BC.png)
### 自顶向下语法分析的通用形式
- 递归下降分析（Recursive-Descent Parsing）
    - 由一组**过程**组成，每个过程对应一个**非终结符**（也就是说，文法中有多少个非终结符，就有多少个过程）
    - 从文法开始符号S对应的过程开始，其中递归调用文法中其他非终结符对应的过程。如果S对应的过程体恰好扫描了整个输入串，则成功完成语法分析
```
void A() {
    选择一个A的产生式， A->X1X2...Xk;
    for ( i = 1 to k) {
        if (Xi是一个非终结符号)
            调用过程Xi();
        else if (Xi等于当前的输入符号a)  // 即Xi是一个终结符
            读入下一个输入符号;
        else 
            // 错误处理
    }    
}
```
可能需要回溯，导致效率较低。如果分析过程中，我们能够预测出正确的产生式，则可以不必回溯，即预测分析
### 预测分析
- 预测分析是递归下降分析技术的一个特例，通过在输入中向前看**固定个数**（通常是1）符号，来选择正确的A-产生式。
    - 可以对某些文法构造出向前看k个输入符号的预测分析器，该类文法有时也成为了```LL(k)```文法类
- 预测分析**不需要回溯**，是一种确定的自顶向下分析方法

# 2. 文法转换
并不是所有的文法都适合自顶向下分析，有时候我们需要改造文法，使其适合使用自顶向下分析。
- 例1，有如下文法G。当输入为```abc```时，同一非终结符的多个候选式存在共同前缀，将导致回溯现象
```
S -> aAd | aBe
A -> c
B -> b
```
- 例2， 有如下文法G：
```
E -> E+T | E-T | T
T -> T*F | T/F | F
F -> (E) | id
```
对于输入```id + id * id```，采用最左推导时，由于产生式的右边与开始符号相同，将导致无限循环替换
```
E -> E + T
  -> E + T + T
  -> E + T + T + T
  -> ....
```
含有```A->Aα```形式的文法称为是**直接左递归**的。如果一个文法中有一个非终结符A使得对某个串```α```存在一个推导```A -> +Aα```，那么这个文法就是左递归的。经过两步或两步以上推导产生的左递归称为是**间接左递归**的。左递归文法会使递归下降分析器陷入无限循环。
## 消除直接左递归的一般形式
$A → Aα1|Aα2|...|Aαn|β1|β2|...|βn (αi≠ε, βj不以A开头)$
转换为：
$A → β1A'|β2A'|...|βmA'$
$A' → α1A'|α2A'|...|αnA'|ε$
消除左递归是要付出代价的——引进了一些非终结符和空产生式